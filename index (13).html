<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Sales Dashboard</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#060606;font-family:-apple-system,'Inter',sans-serif;color:#F1F5F9}
.card{background:#0d0d0d;border-radius:14px;padding:20px 22px;border:1px solid #141414;flex:1;min-width:148px;position:relative;overflow:hidden;cursor:default;transition:all 0.2s}
.card:hover{border-color:#1e1e1e;transform:translateY(-4px) scale(1.02);box-shadow:0 16px 40px rgba(0,0,0,0.7)}
.card:hover .card-top{display:block}
.card-top{display:none;position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,#F97316,#FBBF24)}
.card-label{font-size:10px;color:#888;font-weight:600;text-transform:uppercase;letter-spacing:1.2px;margin-bottom:10px}
.card-value{font-size:30px;font-weight:800;color:#F1F5F9;letter-spacing:-1px;margin-bottom:8px;line-height:1}
.card-sub{font-size:11px;color:#666;line-height:1.4}
.delta-up{font-size:10px;font-weight:700;color:#22D3A5;background:rgba(34,211,165,0.1);border-radius:4px;padding:2px 6px}
.delta-down{font-size:10px;font-weight:700;color:#F43F5E;background:rgba(244,63,94,0.1);border-radius:4px;padding:2px 6px}
.section-label{display:flex;align-items:center;gap:10px;margin-bottom:10px;margin-top:6px}
.section-label span{font-size:9px;color:#666;font-weight:700;text-transform:uppercase;letter-spacing:2px;white-space:nowrap}
.section-label hr{flex:1;border:none;border-top:1px solid #141414}
.tab{background:none;border:none;cursor:pointer;font-size:11px;font-weight:700;color:#888;padding:9px 18px;border-bottom:2px solid transparent;margin-bottom:-1px;transition:all 0.15s;text-transform:uppercase;letter-spacing:1.5px}
.tab.active{color:#F1F5F9;border-bottom-color:#F1F5F9}
.tabs{display:flex;border-bottom:1px solid #141414;margin-bottom:20px;gap:2px}
.row{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap}
.row.mb20{margin-bottom:20px}
.goal-card{background:#0d0d0d;border-radius:14px;padding:24px 26px;border:1px solid #141414;margin-bottom:16px;position:relative;overflow:hidden}
.goal-bar-bg{background:#111;border-radius:99px;height:5px;overflow:hidden;margin-bottom:12px}
.goal-bar{height:100%;background:linear-gradient(90deg,#F97316,#FBBF24);border-radius:99px;transition:width 0.6s;box-shadow:0 0 8px rgba(249,115,22,0.4)}
.chart-container{background:#0d0d0d;border-radius:14px;padding:20px 22px;border:1px solid #141414}
input[type=number]{background:#111;border:1px solid #F97316;border-radius:8px;padding:6px 12px;color:#F1F5F9;font-size:24px;font-weight:800;width:160px;outline:none}
button.save-btn{background:#F97316;border:none;border-radius:8px;padding:7px 14px;color:#000;font-size:11px;font-weight:800;cursor:pointer}
button.cancel-btn{background:none;border:1px solid #1e1e1e;border-radius:8px;padding:7px 12px;color:#666;font-size:11px;cursor:pointer}
button.edit-btn{background:none;border:1px solid #1e1e1e;color:#666;border-radius:5px;padding:2px 8px;font-size:9px;cursor:pointer;font-weight:600;text-transform:uppercase;letter-spacing:0.8px}
.loading{display:flex;align-items:center;justify-content:center;min-height:100vh;color:#333;font-size:12px}
</style>
</head>
<body>
<div id="root"><div class="loading">Loading dashboard...</div></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
// ── CLIENT CONFIG ─────────────────────────────────────
const CLIENTS = [
  {
    slug: "client",
    name: "Client",
    csvUrl: "https://docs.google.com/spreadsheets/d/e/2PACX-1vT7dUSBeMfyhjQwGP4mgQUmJhqX9k9ZvkkHZ9f8LUw_pUmO_5IdzOHauOqv5vuBzAzw_FGgNDOKJVY9/pub?gid=1221331135&single=true&output=csv",
    monthlyTarget: 100000,
  },
  // { slug: "acme", name: "Acme Corp", csvUrl: "YOUR_URL", monthlyTarget: 150000 },
];
// ──────────────────────────────────────────────────────

const BG="#060606",ACCENT="#F97316",GREEN="#22D3A5",RED="#F43F5E",WHITE="#F1F5F9",SUB="#666",MED="#999",LABEL="#888",BORDER="#141414",BORDER2="#1e1e1e";
const fmt$=v=>v.toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0});
const fmtN=v=>Number(v||0).toLocaleString();
const TODAY=new Date();
const MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"];
const SMONTHS=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function getSlug(){return window.location.pathname.replace(/\//g,"").toLowerCase()||"client";}
function getClient(){return CLIENTS.find(c=>c.slug===getSlug());}

function parseCSV(rows){
  if(!rows||!rows.length)return null;
  const g=k=>rows.reduce((a,r)=>a+(parseFloat(r[k])||0),0);
  return {
    cash: g("Cash Collected from Your Sets Today (Closed)"),
    calls: g("Calls Booked"),
    closes: g("Closes"),
    shows: g("Shows"),
    outbounds: g("Outbound Messages Sent"),
    convos: g("Total Conversations Had"),
    followups: g("Follow-Up Conversations"),
    hours: g("Hours Worked"),
    pitched: g("Calls Pitched"),
    inbounds: g("Inbound Conversations"),
    qualified: g("Qualified Calls Booked"),
  };
}

function delta(curr,prev){
  if(!prev)return "";
  const pct=((curr-prev)/prev*100).toFixed(1);
  const up=pct>=0;
  return '<span class="'+(up?"delta-up":"delta-down")+'">'+(up?"^":"v")+" "+Math.abs(pct)+"%</span>";
}

function card(title,value,sub,d){
  return '<div class="card"><div class="card-top"></div><div class="card-label">'+title+'</div><div class="card-value">'+value+'</div><div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:4px">'+(sub?'<div class="card-sub">'+sub+'</div>':'')+(d||"")+'</div></div>';
}

function sectionLabel(name){
  return '<div class="section-label"><span>'+name+'</span><hr></div>';
}

function goalCard(cash,goal,label){
  const pct=Math.min((cash/goal)*100,100).toFixed(0);
  const dayOfMonth=TODAY.getDate();
  const daysInMonth=new Date(TODAY.getFullYear(),TODAY.getMonth()+1,0).getDate();
  const projected=Math.round((cash/dayOfMonth)*daysInMonth);
  const onTrack=projected>=goal;
  const isCurrentMonth=true;
  return '<div class="goal-card">'+
    '<div style="position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,#F97316,#FBBF24,#22D3A5);opacity:0.6"></div>'+
    '<div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px">'+
      '<div>'+
        '<div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">'+
          '<div style="font-size:10px;color:'+LABEL+';font-weight:600;text-transform:uppercase;letter-spacing:1.2px">'+label+' Target</div>'+
          '<button class="edit-btn" onclick="editTarget()">Edit</button>'+
        '</div>'+
        '<div style="display:flex;align-items:baseline;gap:10px;flex-wrap:wrap">'+
          '<span style="font-size:38px;font-weight:800;color:'+WHITE+';letter-spacing:-2px;line-height:1">'+fmt$(cash)+'</span>'+
          '<span style="font-size:15px;color:'+SUB+'">/ '+fmt$(goal)+'</span>'+
        '</div>'+
      '</div>'+
      '<div style="text-align:right">'+
        '<div style="font-size:34px;font-weight:800;background:linear-gradient(135deg,#F97316,#FBBF24);-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:-1px;line-height:1">'+pct+'%</div>'+
        '<div style="font-size:10px;color:'+SUB+';text-transform:uppercase;letter-spacing:1px;margin-top:4px">of target</div>'+
      '</div>'+
    '</div>'+
    '<div class="goal-bar-bg"><div class="goal-bar" style="width:'+pct+'%"></div></div>'+
    '<div style="display:flex;justify-content:space-between">'+
      '<span style="font-size:12px;color:'+SUB+'"><span style="color:'+MED+';font-weight:600">'+fmt$(goal-cash)+'</span> remaining</span>'+
      '<span style="font-size:12px;color:'+SUB+'">Projected: <span style="color:'+(onTrack?GREEN:ACCENT)+';font-weight:700">'+fmt$(projected)+'</span></span>'+
    '</div>'+
  '</div>';
}

function renderOverview(t,client,goal){
  const mLabel=MONTHS[TODAY.getMonth()];
  const closeRate=t.shows>0?((t.closes/t.shows)*100).toFixed(1):"0.0";
  const showRate=t.calls>0?((t.shows/t.calls)*100).toFixed(1):"0.0";
  const aov=t.closes>0?Math.round(t.cash/t.closes):0;
  return goalCard(t.cash,goal,mLabel)+
    '<div class="row">'+
      card("Calls Booked (Qualified)",fmtN(t.qualified),"Qualified calls booked","")+
      card("Show Rate",showRate+"%",fmtN(t.shows)+" of "+fmtN(t.calls)+" showed up","")+
      card("Close Rate",closeRate+"%",fmtN(t.closes)+" of "+fmtN(t.shows)+" calls closed","")+
      card("Avg Order Value",fmt$(aov),"","")+
    '</div>';
}

function renderActivity(t){
  const callToBook=t.convos>0?((t.calls/t.convos)*100).toFixed(1):"0.0";
  return sectionLabel("Outreach")+
    '<div class="row mb20">'+
      card("Outbounds",fmtN(t.outbounds),"Total outbound messages","")+
      card("Follow-Ups",fmtN(t.followups),"Total follow-ups sent","")+
      card("Conversations",fmtN(t.convos),"Active conversations","")+
    '</div>'+
    sectionLabel("Calls")+
    '<div class="row mb20">'+
      card("Calls Pitched",fmtN(t.pitched),"Total calls proposed","")+
      card("Calls Booked",fmtN(t.calls),"Total calls booked","")+
      card("Calls Booked (Qualified)",fmtN(t.qualified),"Total qualified calls booked","")+
    '</div>'+
    sectionLabel("Other")+
    '<div class="row mb20">'+
      card("Inbounds Received",fmtN(t.inbounds),"Inbound leads received","")+
      card("Convo to Book Rate",callToBook+"%",fmtN(t.calls)+" of "+fmtN(t.convos)+" convos","")+
      card("Hours Worked",fmtN(t.hours)+"h","","")+
    '</div>';
}

function editTarget(){
  const current=window.__goal||100000;
  const val=prompt("Enter new monthly target ($):",current);
  if(val&&!isNaN(val)&&parseInt(val)>0){
    window.__goal=parseInt(val);
    try{localStorage.setItem("goal-"+getSlug(),val);}catch(e){}
    render();
  }
}

let currentPage="overview";
let csvData=null;

function render(){
  const client=getClient();
  if(!client){document.getElementById("root").innerHTML='<div class="loading">Client not found</div>';return;}
  const t=csvData||{cash:0,calls:0,closes:0,shows:0,outbounds:0,convos:0,followups:0,hours:0,pitched:0,inbounds:0,qualified:0};
  const goal=window.__goal||client.monthlyTarget;
  const clientName=localStorage.getItem("clientname-"+client.slug)||client.name;

  const content=currentPage==="overview"?renderOverview(t,client,goal):renderActivity(t);

  document.getElementById("root").innerHTML=
    '<div style="background:'+BG+';min-height:100vh;padding:26px 30px">'+
      '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:22px">'+
        '<div>'+
          '<div style="font-size:21px;font-weight:800;letter-spacing:-0.8px">Sales Dashboard</div>'+
          '<div style="font-size:10px;color:'+SUB+';letter-spacing:2.5px;text-transform:uppercase;margin-top:5px;font-weight:600">ML Consulting x '+clientName+'</div>'+
        '</div>'+
        '<div style="font-size:11px;color:'+SUB+'">'+MONTHS[TODAY.getMonth()]+' '+TODAY.getFullYear()+'</div>'+
      '</div>'+
      '<div class="tabs">'+
        '<button class="tab'+(currentPage==="overview"?" active":"")+'" onclick="setPage(\'overview\')">Overview</button>'+
        '<button class="tab'+(currentPage==="activity"?" active":"")+'" onclick="setPage(\'activity\')">Activity</button>'+
      '</div>'+
      content+
    '</div>';
}

function setPage(p){currentPage=p;render();}

function init(){
  const client=getClient();
  if(!client){render();return;}
  try{const g=localStorage.getItem("goal-"+client.slug);if(g)window.__goal=parseInt(g);}catch(e){}
  render();
  Papa.parse(client.csvUrl,{
    download:true,header:true,skipEmptyLines:true,
    complete:function(r){csvData=parseCSV(r.data);render();},
    error:function(){render();}
  });
  setInterval(()=>window.location.reload(),60*60*1000);
}

init();
</script>
</body>
</html>
